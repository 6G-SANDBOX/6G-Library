---
- name: Install nginx ingress controller
  kubernetes.core.helm:
    # kubeconfig: "{{ workspace }}/{{ component_type }}/private/{{ tn_id }}-oneke-{{ service_name }}.kubeconfig"  /etc/rancher/rke2/rke2.yaml
    name: ingress-nginx
    chart_repo_url: https://kubernetes.github.io/ingress-nginx
    chart_ref: ingress-nginx
    namespace: ingress-nginx
    state: present
    create_namespace: yes
    values:
      rbac:
        create: true
      controller:
        service:
          type: NodePort
          nodePorts:
            http: 32080
            https: 32443
        admissionWebhooks:
          enabled: false

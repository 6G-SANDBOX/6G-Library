######################################################
##
## Component public variables
##
## Variables accesible to the experimenter.
##
## They are contained inside 4 global variables
## with all required info:
##   1. name: name of the component
##
##   2. metadata: General information like mantainers,
##      component dependencies and allowed platforms
##
##   3. input: Customizable variables for each
##      deployment to be filled by the experimenter
##      or the TNLCM
##
##   4. output: Values sent to the TNLCM callback to
##      keep track of the TN deployments
##
## File previously found at "public/description.yaml"
##
######################################################


####################################
## Component name
####################################
name: k8s_medium

####################################
## Component metadata
####################################
metadata:
  maintainers:
    - Jesus Macias Portela <jesus.maciasportela@telefonica.com>
    - Ana Isabel Lara García <anaisabel.laragarcia@telefonica.com>
    - Álvaro Curto Merino <alvaro.curtomerino@telefonica.com>
  needs:
    - vxlan:
  short_description: This is a component to deploy a K8S cluster medium size.
  long_description: |
    This component deploy a K8S cluster using the oneKE service created by OpenNebula.
    It creates a 3 node cluster: master, worker, storage-worker
    More info in this url: https:// ....
  hypervisors: [one]
  sites: [uma, athens, fokus]

####################################
## Component input
####################################
input:
  external_vnet_id:
    description: Name of the VNet used to access the OneKE cluster. Most cases will use the Trial Network tn_vxlan
    type: "int"
    value: ""
    user_input: true
    optional: false

  internal_vnet_id:
    description: Name of the VNet used to interconnect the OneKE nodes. A vxlan component
    type: "int"
    value: ""
    user_input: true
    optional: false

  multus_enabled:
    description: |
      Multus is a CNI (Container Network Interface) that enables attaching multiple network interfaces to pods.
      The Multus CNI is compatible with the primary CNI chosen not a substitute of it
      Accepted values are "YES" or "NO" (quotes included). Default value is "YES"
    type: "str"
    choices:
      - "YES"
      - "NO"
    value: "YES"
    user_input: true
    optional: true
  cni_plugin:
    description: |
      Primary CNI (Container Network Interface) to be enabled inside the OneKE for the connectivity between pods.
      Accepted values are:
        * cilium: High performant CNI with a plethora of functionalities with an eBPF-based dataplane.
        * calico: Popular CNI with advanced network policies, flat Layer 3 network and NAT for outbound traffic.
        * canal: combines Flannel and Calico, Flannel for pod traffic between hosts and Calico for network polico enforcement and pod to pod traffic. Canal CNI will not be supported after OneKE 1.27
    type: "str"
    choices::
      - "cilium"
      - "calico"
      - "canal"
    value: "canal"
    user_input: true
    optional: true

  longhorn_enabled:
    description: |
      Longhorn provides highly available persistent storage for Kubernetes
      Accepted values are "YES" or "NO" (quotes included). Default value is "YES"
    type: "str"
    choices:
      - "YES"
      - "NO"
    value: "YES"
    user_input: true
    optional: false   # will be optional in the near future

  metallb_enabled: 
    description: |
      Load-balancer implementation for bar metal Kubernetes clusters, using standard routing protocols
      Accepted values are "YES" or "NO" (quotes included). Default value is "YES"
    type: "str"
    choices:
      - "YES"
      - "NO"
    value: "YES"
    user_input: true
    optional: false   # will be optional in the near future

  metallb_range:
    description: |
      Range of IPs available for metalLB to allocate services. Part of the Adress Range from the "internal_vnet_id"
      Syntax is <min_IPv4>-<max_IPv4>
      Mandatory variable if metallb_enabled is set to "YES"
    type: "str"
    value: "10.10.12.200-10.10.12.240"
    user_input: true
    optional: false   # will be optional in the near future. It will still be mandatory if metallb_enabled is set to "YES"

  traefik_enabled:
    description: |
      Ingress controller that manages access to cluster services.
      Accepted values are "YES" or "NO" (quotes included). Default value is "YES"
    type: "str"
    choices:
      - "YES"
      - "NO"
    value: "NO"
    user_input: true
    optional: false   # will be optional in the near future

  vnf_upstream_dns:
    description: space-separated DNS servers configured in the OneKE VNF
    type: "str"
    value: "1.1.1.1 8.8.8.8"
    user_input: true
    optional: false   # will be optional in the near future

####################################
## Component output
####################################
output:
  kubeconfig: "Kubeconfig file to access to this cluster"

        # "kubeconfig": "{{ kubeconfig_content | b64encode }}"
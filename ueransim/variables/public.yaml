######################################################
##
## Component public variables
##
## Variables accesible to the experimenter.
##
## They are contained inside 4 global variables
## with all required info:
##   1. name: name of the component
##
##   2. metadata: General information like mantainers,
##      component dependencies and allowed platforms
##
##   3. input: Customizable variables for each
##      deployment to be filled by the experimenter
##      or the TNLCM
##
##   4. output: Values sent to the TNLCM callback to
##      keep track of the TN deployments
##
## File previously found at "public/description.yaml"
##
######################################################


####################################
## Component name
####################################
name: ueransim

####################################
## Component metadata
####################################
metadata:
  maintainers:
    - Jesus Macias Portela <jesus.maciasportela@telefonica.com>
    - Ana Isabel Lara García <anaisabel.laragarcia@telefonica.com>
    - Álvaro Curto Merino <alvaro.curtomerino@telefonica.com>
  needs:
    - tn_vxlan:
    - tn_bastion:
    - open5gs:
        if:                # dependency aplied if this "AND" list of input value conditions is satisfied
          run_gnb: "YES"
    - ueransim:
        with:              # dependency on an previously deployed ueransim component with input value run_gnb: "YES"
          run_gnb: "YES"
        if:                # dependency aplied if this "AND" list of input value conditions is satisfied
          run_ue: "YES"
          run_gnb: "NO"
  short_description: This is the component to deploy a UERANSIM instance 
  long_description: |
    This is the component to deploy a UERANSIM instance into a Trial Network. It can be deployed as:
    - UE
    - gNB
  hypervisors: [one]
  sites: [uma, athens, fokus]

####################################
## Component input
####################################
input:
  one_component_name:
    description: Unique name to identify the ueransim component inside the Trial Network
    type: "str"
    value: "PLACEHOLDER_VM_NAME"
    user_input: true
    optional: false
  one_vm_username: 
    description: |
      Privileged user (other than root) to access the VM by SSH
      NOTE: If no username is provided, the only user will be root and ssh access may not be available (sshd_config: PermitRootLogin without-password)
    type: "str"
    value:
    user_input: true
    optional: true
  one_vm_password:
    description: Password to access the VM by SSH. Useful only if "one_vm_username" is defined
    type: "str"
    value:
    user_input: true
    optional: true
  one_vm_ssh_key:
    description: SSH public key loaded into /home/"one_vm_username"/.ssh/authorized_keys. If "one_vm_username" is not defined, it will default to /root/.ssh/authorized_keys
    type: "str"
    value:
    user_input: true
    optional: true
  one_component_networks:
    description: OpenNebula IDs of the VNets the VM will be part of. First will be the tn_vxlan ID in most cases
    type: "intlist"
    value:
    user_input: true
    optional: false

  oneke_vnf:
    description: Proxy address to send the traffic to reach the "gnb_amf_address". The IPv4 address of a OneKE VNF inside your Trial Network
    type: "str"
    value: "127.0.0.1"
    user_input: true
    optional: true

  run_gnb:
    description: |
      Enable ueransim-gnb.service at start. If "YES", requires a functional open5gs appliance previously deployed
      Accepted values are "YES" or "NO" (quotes included). Default value is "YES"
    type: "str"
    choices:
      - "YES"
      - "NO"
    value: "NO"
    user_input: true
    optional: true
  gnb_mcc:
    description: In gNB simulation, Mobile Country Code (MCC) used in the Public Land Mobile Network (PLMN). 3 digits inside quotes.
    type: "str"
    value: "999"
    user_input: true
    optional: true
  gnb_mnc:
    description: In gNB simulation, Mobile Network Code (MNC) used in the Public Land Mobile Network (PLMN). 2 digits inside quotes.
    type: "str"
    value: "70"
    user_input: true
    optional: true
  gnb_tac:
    description: In gNB simulation, Tracking Area Code in the PLMN
    type: "str"
    value: "1"
    user_input: true
    optional: true
  gnb_amf_address:
    description: |
      In gNB simulation, IPv4 address of the Access Management Function (AMF).
      If "oneke_vnf" is defined, this address is expected to be behind it, so the necessary routing rules will be automatically defined
      AMF port is currently hardcoded to always be 38412
    type: "str"
    value: "127.0.0.5"
    user_input: true
    optional: true
  gnb_slices_sst:
    description: In gNB simulation, Slice/Service Type (SST) of the Single-Network Slice Selection Assistant Information (S-NSSAI)
    type: "int"
    value: 1
    user_input: true
    optional: true
  gnb_slices_sd:
    description: In gNB simulation, Slice Differentiator (SD) of the Single-Network Slice Selection Assistant Information (S-NSSAI)
    type: "int"
    value: 1
    user_input: true
    optional: true

  run_ue:
    description: |
      Enable ueransim-ue.service at start. If "YES", requires either to set run_gnb="YES", or to have a functional ueransim with run_gnb="YES" previously deployed.
      Accepted values are "YES" or "NO" (quotes included). Default value is "YES"
    type: "str"
    choices:
      - "YES"
      - "NO"
    value: "NO"
    user_input: true
    optional: true
  ue_supi:
    description: In UE simulation, IMSI number of the UE. IMSI = [MCC|MNC|MSISDN] (In total 15 digits)
    type: "str"
    value: 'imsi-999700000000001'
    user_input: true
    optional: true
  ue_mcc:
    description: In UE simulation, Mobile Country Code (MCC) used in the Public Land Mobile Network (PLMN). 3 digits inside quotes.
    type: "str"
    value: "999"
    user_input: true
    optional: true
  ue_mnc:
    description: In UE simulation, Mobile Network Code (MNC) used in the Public Land Mobile Network (PLMN). 2 digits inside quotes.
    type: "str"
    value: "70"
    user_input: true
    optional: true
  ue_key:
    description: In UE simulation, Permanent subscription key
    type: "str"
    value: 465B5CE8B199B49FAA5F0A2EE238A6BC
    user_input: true
    optional: true
  ue_op:
    description: In UE simulation, Operator code (OP or OPC) of the UE
    type: "str"
    value: E8ED289DEBA952E4283B54E88E6183CA
    user_input: true
    optional: true
  ue_gnbSearchList:
    description: In UE simulation, IP address for Radio Link Simulation
    type: "str"
    value: "127.0.0.1"
    user_input: true
    optional: true
  ue_session_apn:
    description: In UE simulation, Access Point Name (APN) of the initial PDU session to be established
    type: "str"
    value: internet
    user_input: true
    optional: true
  ue_session_sst:
    description: In UE simulation, Slice/Service Type (SST) of the initial PDU session to be established
    type: "int"
    value: 1
    user_input: true
    optional: true
  ue_session_sd:
    description: In UE simulation, Slice Differentiator (SD) of the initial PDU session to be established
    type: "int"
    value:
    user_input: true
    optional: true
  ue_configured_nssai_sst:
    description: In UE simulation, Slice/Service Type (SST) of the configured NSSAI by HPLMN
    type: "int"
    value: 1
    user_input: true
    optional: true
  ue_configured_nssai_sd:
    description: In UE simulation, Slice Differentiator (SD) of the configured NSSAI by HPLMN
    type: "int"
    value:
    user_input: true
    optional: true
  ue_default_nssai_sst:
    description: In UE simulation, Slice/Service Type (SST) of the default NSSAI
    type: "int"
    value: 1
    user_input: true
    optional: true
  ue_default_nssai_sd:
    description: In UE simulation, Slice Differentiator (SD) of the default NSSAI
    type: "int"
    value: 1
    user_input: true
    optional: true

####################################
## Component input
####################################
output:
  - network_assignments:        # OpenNebula VM Network Assignments
  - vm_id:                      # OpenNebula VM ID

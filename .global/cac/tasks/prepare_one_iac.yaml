---
- name: Prepare opennebula provider terraform manifest
  ansible.builtin.copy:
    src: "{{ workspace }}/.global/iac/{{ site_hypervisor }}/opennebula_provider_v1.4.tf"
    dest: "{{ workspace }}/{{ library_component_name }}/code/{{ site_hypervisor }}/iac/opennebula_provider_v1.4.tf"

- name: Prepare AWS s3 backend terraform manifest
  ansible.builtin.template:
    src: "{{ workspace }}/.global/iac/backend.tf.j2"
    dest: "{{ workspace }}/{{ library_component_name }}/code/{{ site_hypervisor }}/iac/backend.tf"

- name: "Prepare {{ library_component_name }} terraform manifest"
  ansible.builtin.template:
    src: "{{ workspace }}/{{ library_component_name }}/code/{{ site_hypervisor }}/iac/terraform.tf.j2"
    dest: "{{ workspace }}/{{ library_component_name }}/code/{{ site_hypervisor }}/iac/{{ library_component_name }}{{
           '-'+entity_name if entity_name is not none else '' }}.tf"

- name: "Get terraform manifests from previous deployed components"
  ansible.builtin.include_tasks: "{{ workspace }}/.global/cac/tasks/s3_download.yaml"

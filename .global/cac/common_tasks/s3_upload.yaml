- name: Upload terraform manifest to S3
  amazon.aws.s3_object:
    endpoint_url: "{{ site_s3_server.endpoint }}"
    mode: put
    access_key: "{{ ansible_env.AWS_ACCESS_KEY_ID }}"
    secret_key: "{{ ansible_env.AWS_SECRET_ACCESS_KEY }}"
    bucket: "{{ site_s3_server.bucket }}"
    object: "{{ tn_id }}/tf-{{ entity_name }}.tf"
    src: "{{ workspace }}/{{ component_type }}/code/{{ site_hypervisor }}/iac/tf-{{ entity_name }}.tf"
    encrypt: no


- name: Send OK markdown response to S3
  amazon.aws.s3_object:
    endpoint_url: "{{ site_s3_server.endpoint }}"
    mode: put
    access_key: "{{ ansible_env.AWS_ACCESS_KEY_ID }}"
    secret_key: "{{ ansible_env.AWS_SECRET_ACCESS_KEY }}"
    bucket: "{{ site_s3_server.bucket }}"
    object: "{{ tn_id }}/ok_result-{{ entity_name }}.md"
    src: "{{ workspace }}/{{ component_type }}/code/ok_result-{{ entity_name }}.md"
    encrypt: no
